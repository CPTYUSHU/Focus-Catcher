<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Catcher - æµ‹è¯•é¡µé¢</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      color: #333;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .test-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #667eea;
    }

    .test-content {
      line-height: 1.8;
      color: #333;
      margin-bottom: 15px;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .log {
      margin-top: 20px;
      padding: 15px;
      background: #2d3748;
      color: #a0aec0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }

    .log-entry {
      margin-bottom: 5px;
    }

    .log-success {
      color: #48bb78;
    }

    .log-error {
      color: #f56565;
    }

    .log-info {
      color: #4299e1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Focus Catcher æµ‹è¯•é¡µé¢</h1>
    <p class="subtitle">æµ‹è¯•æ’ä»¶åœ¨ä¸åŒç½‘é¡µä¸Šçš„è¿è¡Œæƒ…å†µ</p>

    <!-- æµ‹è¯• 1ï¼šContent Script åŠ è½½ -->
    <div class="test-section">
      <div class="test-title">æµ‹è¯• 1ï¼šContent Script æ˜¯å¦åŠ è½½</div>
      <div class="test-content">
        æ’ä»¶çš„ content script åº”è¯¥åœ¨æ‰€æœ‰ç½‘é¡µä¸Šè‡ªåŠ¨åŠ è½½ã€‚
      </div>
      <div>
        çŠ¶æ€ï¼š<span id="status1" class="status status-pending">æ£€æµ‹ä¸­...</span>
      </div>
    </div>

    <!-- æµ‹è¯• 2ï¼šå¿«æ·é”®ç›‘å¬ -->
    <div class="test-section">
      <div class="test-title">æµ‹è¯• 2ï¼šå¿«æ·é”®ç›‘å¬</div>
      <div class="test-content">
        é€‰ä¸­ä¸‹é¢çš„æ–‡å­—ï¼Œç„¶åæŒ‰å¿«æ·é”®ï¼ˆCmd+Shift+C æˆ–ä½ è®¾ç½®çš„å¿«æ·é”®ï¼‰ï¼š<br><br>
        <strong>è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡å­—ã€‚è¯·é€‰ä¸­è¿™æ®µæ–‡å­—å¹¶æŒ‰å¿«æ·é”®è¿›è¡Œæ•æ‰ã€‚</strong>
      </div>
      <div>
        çŠ¶æ€ï¼š<span id="status2" class="status status-pending">ç­‰å¾…æµ‹è¯•...</span>
      </div>
    </div>

    <!-- æµ‹è¯• 3ï¼šåç«¯è¿æ¥ -->
    <div class="test-section">
      <div class="test-title">æµ‹è¯• 3ï¼šåç«¯ API è¿æ¥</div>
      <div class="test-content">
        æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿè¿æ¥åˆ° FastAPI åç«¯ã€‚
      </div>
      <button class="button" onclick="testBackend()">ğŸ”— æµ‹è¯•åç«¯è¿æ¥</button>
      <div style="margin-top: 10px;">
        çŠ¶æ€ï¼š<span id="status3" class="status status-pending">æœªæµ‹è¯•</span>
      </div>
    </div>

    <!-- æµ‹è¯• 4ï¼šå®Œæ•´æ•æ‰æµç¨‹ -->
    <div class="test-section">
      <div class="test-title">æµ‹è¯• 4ï¼šå®Œæ•´æ•æ‰æµç¨‹</div>
      <div class="test-content">
        æµ‹è¯•ä»é€‰ä¸­æ–‡å­—åˆ°ä¿å­˜åˆ°æ•°æ®åº“çš„å®Œæ•´æµç¨‹ã€‚
      </div>
      <button class="button" onclick="testFullCapture()">ğŸ¯ æµ‹è¯•å®Œæ•´æ•æ‰</button>
      <div style="margin-top: 10px;">
        çŠ¶æ€ï¼š<span id="status4" class="status status-pending">æœªæµ‹è¯•</span>
      </div>
    </div>

    <!-- æ—¥å¿— -->
    <div class="log" id="log">
      <div class="log-entry log-info">[INFO] æµ‹è¯•é¡µé¢å·²åŠ è½½</div>
    </div>
  </div>

  <script>
    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus(id, text, type) {
      const status = document.getElementById(id);
      status.textContent = text;
      status.className = `status status-${type}`;
    }

    // æµ‹è¯• 1ï¼šæ£€æµ‹ Content Script
    setTimeout(() => {
      // æ£€æŸ¥æ˜¯å¦æœ‰ focus-catcher ç›¸å…³çš„å…ƒç´ æˆ–å…¨å±€å˜é‡
      if (typeof chrome !== 'undefined' && chrome.runtime) {
        log('[TEST 1] Chrome extension API å¯ç”¨', 'success');
        updateStatus('status1', 'âœ… Content Script å·²åŠ è½½', 'success');
      } else {
        log('[TEST 1] Chrome extension API ä¸å¯ç”¨', 'error');
        updateStatus('status1', 'âŒ Content Script æœªåŠ è½½', 'error');
      }
    }, 500);

    // æµ‹è¯• 2ï¼šç›‘å¬æ•æ‰äº‹ä»¶
    let captureAttempted = false;
    document.addEventListener('selectionchange', () => {
      const selection = window.getSelection().toString();
      if (selection && selection.length > 10) {
        if (!captureAttempted) {
          log('[TEST 2] æ£€æµ‹åˆ°æ–‡å­—é€‰ä¸­ï¼Œè¯·æŒ‰å¿«æ·é”®', 'info');
          captureAttempted = true;
        }
      }
    });

    // æµ‹è¯• 3ï¼šæµ‹è¯•åç«¯è¿æ¥
    async function testBackend() {
      log('[TEST 3] æ­£åœ¨æµ‹è¯•åç«¯è¿æ¥...', 'info');
      updateStatus('status3', 'â³ æµ‹è¯•ä¸­...', 'pending');
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api');
        const data = await response.json();
        
        if (data.status === 'ok') {
          log('[TEST 3] âœ… åç«¯è¿æ¥æˆåŠŸ', 'success');
          updateStatus('status3', 'âœ… åç«¯è¿æ¥æ­£å¸¸', 'success');
        } else {
          log('[TEST 3] âŒ åç«¯å“åº”å¼‚å¸¸', 'error');
          updateStatus('status3', 'âŒ åç«¯å“åº”å¼‚å¸¸', 'error');
        }
      } catch (error) {
        log(`[TEST 3] âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}`, 'error');
        updateStatus('status3', 'âŒ æ— æ³•è¿æ¥åç«¯', 'error');
      }
    }

    // æµ‹è¯• 4ï¼šæµ‹è¯•å®Œæ•´æ•æ‰æµç¨‹
    async function testFullCapture() {
      log('[TEST 4] æ­£åœ¨æµ‹è¯•å®Œæ•´æ•æ‰æµç¨‹...', 'info');
      updateStatus('status4', 'â³ æµ‹è¯•ä¸­...', 'pending');
      
      const testData = {
        selected_text: 'è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡å­—ï¼Œç”¨äºéªŒè¯æ•æ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚',
        page_url: window.location.href,
        page_title: document.title
      };
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api/focus/capture', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(testData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          log('[TEST 4] âœ… æ•æ‰æˆåŠŸï¼', 'success');
          log(`[TEST 4] Session ID: ${data.session_id}, Capture ID: ${data.capture_id}`, 'info');
          updateStatus('status4', 'âœ… æ•æ‰æµç¨‹æ­£å¸¸', 'success');
          updateStatus('status2', 'âœ… å¿«æ·é”®åº”è¯¥å¯ä»¥å·¥ä½œ', 'success');
        } else {
          log('[TEST 4] âŒ æ•æ‰å¤±è´¥', 'error');
          updateStatus('status4', 'âŒ æ•æ‰æµç¨‹å¼‚å¸¸', 'error');
        }
      } catch (error) {
        log(`[TEST 4] âŒ æ•æ‰å¤±è´¥: ${error.message}`, 'error');
        updateStatus('status4', 'âŒ æ•æ‰æµç¨‹å¼‚å¸¸', 'error');
      }
    }

    // è‡ªåŠ¨è¿è¡Œæµ‹è¯• 3
    setTimeout(() => {
      testBackend();
    }, 1000);
  </script>
</body>
</html>

