# Focus Catcher - 故障排除指南

## 🔍 快捷键不工作？

### 问题：按快捷键没有反应，没有捕捉到内容

#### ✅ 解决步骤

**步骤 1：检查快捷键是否已设置**

1. 访问 `chrome://extensions/shortcuts`
2. 找到 **"Focus Catcher"**
3. 查看 **"捕捉选中的文字"** 是否有快捷键
4. 如果显示 **"未设置"**，点击输入框设置快捷键

**步骤 2：检查快捷键是否冲突**

1. 在 `chrome://extensions/shortcuts` 页面
2. 查看是否有其他插件使用相同快捷键
3. 如果有冲突，Chrome 会显示警告
4. 更换一个不冲突的快捷键

**步骤 3：检查是否选中了文字**

1. 在网页上用鼠标选中一段文字
2. 确保文字处于高亮状态
3. 然后按快捷键

**步骤 4：检查后端服务是否运行**

1. 打开新标签页
2. 访问 `http://localhost:8000/api`
3. 应该看到 JSON 响应：`{"status": "ok", ...}`
4. 如果无法访问，需要启动后端服务：
   ```bash
   cd /Users/aiden/fastapiapp
   ./start.sh
   ```

**步骤 5：检查浏览器控制台**

1. 在网页上按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 按快捷键后查看是否有错误信息
4. 应该看到：`[Focus Catcher] Capturing: ...`

**步骤 6：刷新插件和网页**

1. 访问 `chrome://extensions/`
2. 找到 **Focus Catcher**
3. 点击 **"刷新"** 按钮 🔄
4. 刷新正在测试的网页（`Cmd+R` / `Ctrl+R`）
5. 重新尝试

---

## 🔍 Toast 提示不显示？

### 问题：按快捷键后没有看到 "✅ 已捕捉" 提示

#### ✅ 解决步骤

**步骤 1：检查设置**

1. 点击插件图标 → **"⚙️ 设置"**
2. 确认 **"显示捕捉成功提示（Toast）"** 已勾选
3. 点击 **"💾 保存设置"**

**步骤 2：检查是否被网页样式覆盖**

1. 按 `F12` 打开开发者工具
2. 切换到 **Elements** 标签
3. 搜索 `focus-catcher-toast`
4. 查看元素是否存在，以及 CSS 样式

**步骤 3：尝试在不同网页测试**

某些网页的 CSS 可能会影响 Toast 显示，尝试在以下网页测试：
- `https://www.wikipedia.org`
- `https://www.github.com`
- `http://localhost:8000/test_capture.html`

---

## 🔍 捕捉的内容没有保存到历史记录？

### 问题：按快捷键后有提示，但历史记录中没有

#### ✅ 解决步骤

**步骤 1：检查后端日志**

1. 查看运行 `./start.sh` 的终端
2. 应该看到类似的日志：
   ```
   [Focus Catcher] 🎯 New capture request...
   [Focus Catcher] ✅ Capture saved successfully
   ```
3. 如果看到错误，记录错误信息

**步骤 2：检查数据库**

1. 访问 `http://localhost:8000/api/focus/sessions`
2. 应该看到会话列表
3. 检查 `capture_count` 是否增加

**步骤 3：刷新历史记录页面**

1. 访问 `http://localhost:8000/test_capture.html`
2. 按 `Cmd+R` / `Ctrl+R` 刷新页面
3. 查看是否显示新捕捉的内容

---

## 🔍 AI 分析不工作？

### 问题：点击 "🤖 AI 分析" 按钮没有反应

#### ✅ 解决步骤

**步骤 1：检查捕捉数量**

- AI 分析按钮只在会话有 **5 条或以上** 捕捉时显示
- 确保已经捕捉了足够的内容

**步骤 2：检查 API 密钥**

1. 查看 `.env` 文件
2. 确认 `GOOGLE_API_KEY` 已设置
3. 重启后端服务

**步骤 3：查看后端日志**

1. 点击 AI 分析按钮后
2. 查看终端日志
3. 应该看到：
   ```
   [Focus Catcher] 🤖 Starting AI analysis...
   [Focus Catcher] ✅ Analysis completed
   ```

**步骤 4：检查网络连接**

- AI 分析需要调用 Google Gemini API
- 确保网络连接正常
- 确保可以访问 Google 服务

---

## 🔍 自动分析不触发？

### 问题：达到阈值后没有自动分析

#### ✅ 解决步骤

**步骤 1：检查设置**

1. 点击插件图标 → **"⚙️ 设置"**
2. 确认 **"达到 5 条捕捉时自动触发 AI 分析"** 已勾选
3. 检查 **"自动分析阈值"** 设置
4. 点击 **"💾 保存设置"**

**步骤 2：检查通知权限**

1. 访问 `chrome://settings/content/notifications`
2. 确保 Chrome 允许显示通知
3. 确保 Focus Catcher 有通知权限

**步骤 3：查看后台日志**

1. 访问 `chrome://extensions/`
2. 找到 **Focus Catcher**
3. 点击 **"检查视图：Service Worker"**
4. 查看 Console 日志

---

## 🔍 双击自动捕捉不工作？

### 问题：双击文字没有自动捕捉

#### ✅ 解决步骤

**步骤 1：检查设置**

1. 点击插件图标 → **"⚙️ 设置"**
2. 确认 **"双击文字时自动捕捉"** 已勾选
3. 点击 **"💾 保存设置"**

**步骤 2：刷新网页**

1. 保存设置后，刷新正在测试的网页
2. 双击文字应该会自动捕捉

**步骤 3：注意双击方式**

- 双击后需要等待 100ms
- 确保文字已被选中（高亮显示）

---

## 🔍 常见错误信息

### "❌ 请先选中文字"

**原因**：没有选中文字就按了快捷键  
**解决**：先用鼠标选中文字，然后按快捷键

### "❌ 捕捉失败"

**原因**：后端服务未运行或网络错误  
**解决**：
1. 启动后端服务：`./start.sh`
2. 检查 `http://localhost:8000/api` 是否可访问
3. 查看浏览器控制台的错误信息

### "Failed to fetch"

**原因**：无法连接到后端 API  
**解决**：
1. 确认后端服务正在运行
2. 检查 `manifest.json` 中的 `host_permissions`
3. 确认端口是 8000

---

## 📞 还是无法解决？

### 调试信息收集

请提供以下信息：

1. **浏览器控制台日志**（F12 → Console）
2. **后端终端日志**（运行 `./start.sh` 的终端）
3. **插件后台日志**（chrome://extensions/ → 检查视图）
4. **操作步骤**（详细描述你做了什么）
5. **Chrome 版本**（chrome://version/）
6. **操作系统**（Mac / Windows / Linux）

---

## 🎯 快速测试清单

测试快捷键功能是否正常：

- [ ] 后端服务已启动（`./start.sh`）
- [ ] 访问 `http://localhost:8000/api` 返回 JSON
- [ ] 插件已安装并启用
- [ ] 快捷键已在 `chrome://extensions/shortcuts` 中设置
- [ ] 在网页上选中文字
- [ ] 按快捷键
- [ ] 看到 "✅ 已捕捉" Toast 提示
- [ ] 访问 `http://localhost:8000/test_capture.html` 看到捕捉记录

如果以上步骤都完成，快捷键应该正常工作！🎉

