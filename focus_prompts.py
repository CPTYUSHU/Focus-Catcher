"""
Focus Catcher - AI Analysis Prompts
AI åˆ†ææç¤ºè¯
"""

# å•æ¡æ•æ‰åˆ†æ Promptï¼ˆè½»é‡åˆ†æï¼‰
CAPTURE_ANALYSIS_PROMPT = """ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ æ„å›¾è¯†åˆ«åŠ©æ‰‹ã€‚ç”¨æˆ·åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ•æ‰äº†ä»¥ä¸‹å†…å®¹ï¼š

**æ•æ‰å†…å®¹ï¼š**
{selected_text}

**é¡µé¢æ ‡é¢˜ï¼š**
{page_title}

**é¡µé¢ URLï¼š**
{page_url}

**ä»»åŠ¡ï¼š**
è¯·åˆ†æç”¨æˆ·å¯èƒ½åœ¨å…³æ³¨ä»€ä¹ˆé—®é¢˜æˆ–çŸ¥è¯†ç‚¹ã€‚

**è¾“å‡º JSON æ ¼å¼ï¼š**
{{
  "focus_point": "ç”¨æˆ·å…³æ³¨çš„æ ¸å¿ƒé—®é¢˜æˆ–çŸ¥è¯†ç‚¹ï¼ˆ1-2å¥è¯ï¼‰",
  "content_type": "æ¦‚å¿µå®šä¹‰ | æ“ä½œæ­¥éª¤ | ç–‘é—®å›°æƒ‘ | ç¤ºä¾‹ä»£ç  | å‚è€ƒèµ„æ–™ | å…¶ä»–",
  "suggested_action": "å»ºè®®çš„åç»­è¡ŒåŠ¨ï¼ˆ1å¥è¯ï¼‰"
}}

**æ³¨æ„ï¼š**
- åªè¿”å› JSONï¼Œä¸è¦å…¶ä»–å†…å®¹
- focus_point è¦ç®€æ´æ˜ç¡®
- content_type å¿…é¡»æ˜¯åˆ—å‡ºçš„ç±»å‹ä¹‹ä¸€
- suggested_action è¦å…·ä½“å¯æ‰§è¡Œ
"""

# ä¼šè¯æ·±åº¦åˆ†æ Promptï¼ˆæ‰¹é‡åˆ†æï¼‰
SESSION_ANALYSIS_PROMPT = """ä½ æ˜¯ä¸€ä¸ªå­¦ä¹ å›é¡¾åŠ©æ‰‹ã€‚ç”¨æˆ·åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ•æ‰äº†ä¸€äº›å†…å®¹ç‰‡æ®µï¼Œç°åœ¨éœ€è¦ä½ å¸®åŠ©ä»–ä»¬æ— æŸåœ°å›é¡¾è¿™äº›å†…å®¹ã€‚

**ä¼šè¯ä¿¡æ¯ï¼š**
- ä¼šè¯ ID: {session_id}
- å¼€å§‹æ—¶é—´: {start_time}
- æ•æ‰æ•°é‡: {capture_count}

**æ•æ‰åˆ—è¡¨ï¼š**
{captures_list}

**ä½ çš„ä»»åŠ¡ï¼š**
ä½œä¸ºä¸€ä¸ªè®°å¿†é”šç‚¹ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå›é¡¾è¿™æ¬¡å­¦ä¹ ä¼šè¯ã€‚è¯·åˆ†æï¼š

1. **æ ¸å¿ƒä¸»é¢˜** - è¿™äº›æ•æ‰å›´ç»•ä»€ä¹ˆä¸»é¢˜ï¼Ÿç”¨ä¸€å¥è¯æ¦‚æ‹¬
2. **å…³é”®ä¿¡æ¯ç‚¹** - æå–å‡ºæœ€é‡è¦çš„ 3-5 ä¸ªä¿¡æ¯ç‚¹ï¼ˆä¿æŒåŸæ–‡å…³é”®è¯ï¼‰
3. **å†…å®¹è„‰ç»œ** - è¿™äº›æ•æ‰ä¹‹é—´çš„é€»è¾‘å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ
4. **é‡ç‚¹å†…å®¹** - å“ªäº›æ˜¯ç”¨æˆ·å¯èƒ½éœ€è¦é‡ç‚¹å›é¡¾çš„ï¼Ÿ
5. **é—ç•™é—®é¢˜** - æœ‰å“ªäº›é—®é¢˜æˆ–æ¦‚å¿µå¯èƒ½è¿˜éœ€è¦è¿›ä¸€æ­¥æŸ¥é˜…ï¼Ÿ

**è¾“å‡º JSON æ ¼å¼ï¼š**
{{
  "core_goal": "æ ¸å¿ƒä¸»é¢˜ï¼ˆä¸€å¥è¯ï¼Œä¿æŒç®€æ´ï¼‰",
  "main_thread": ["å…³é”®ä¿¡æ¯ç‚¹ 1", "å…³é”®ä¿¡æ¯ç‚¹ 2", "å…³é”®ä¿¡æ¯ç‚¹ 3"],
  "branches": ["ç›¸å…³å»¶ä¼¸ç‚¹ 1", "ç›¸å…³å»¶ä¼¸ç‚¹ 2"],
  "understood": ["å·²è¦†ç›–çš„å†…å®¹ 1", "å·²è¦†ç›–çš„å†…å®¹ 2"],
  "unclear": ["å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æŸ¥é˜…çš„é—®é¢˜ 1", "å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æŸ¥é˜…çš„é—®é¢˜ 2"],
  "action_guide": ["å›é¡¾å»ºè®® 1", "å›é¡¾å»ºè®® 2", "å›é¡¾å»ºè®® 3"],
  "learning_pattern": "å†…å®¹ç‰¹ç‚¹è§‚å¯Ÿï¼ˆå¦‚ï¼šæ¦‚å¿µå¯†é›†å‹ã€å®æ“æ­¥éª¤å‹ã€é—®é¢˜æ¢ç´¢å‹ç­‰ï¼‰"
}}

**é‡è¦åŸåˆ™ï¼š**
- ä¿æŒå®¢è§‚ï¼Œæå–åŸæ–‡å…³é”®ä¿¡æ¯ï¼Œä¸è¦è¿‡åº¦è§£è¯»
- å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå›å¿†èµ·"æˆ‘å½“æ—¶åœ¨çœ‹ä»€ä¹ˆ"
- ä½œä¸ºè®°å¿†é”šç‚¹ï¼Œè®©ç”¨æˆ·èƒ½æ— æŸå›é¡¾
- åªè¿”å› JSONï¼Œä¸è¦å…¶ä»–å†…å®¹
"""

# ç”Ÿæˆå­¦ä¹ æŒ‡å— Promptï¼ˆç”¨æˆ·å‹å¥½çš„è¾“å‡ºï¼‰
LEARNING_GUIDE_PROMPT = """åŸºäºä»¥ä¸‹åˆ†æç»“æœï¼Œç”Ÿæˆä¸€ä¸ªæ¸…æ™°çš„å›é¡¾æŒ‡å—ã€‚

**åˆ†æç»“æœï¼š**
{analysis_result}

**ä½ çš„ä»»åŠ¡ï¼š**
å°†åˆ†æç»“æœè½¬æ¢ä¸ºä¸€ä¸ªç®€æ´çš„å›é¡¾æŒ‡å—ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå›å¿†è¿™æ¬¡å­¦ä¹ çš„å†…å®¹ã€‚

**ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ï¼š**
1. ç»å¯¹ä¸è¦ä½¿ç”¨ä»»ä½• Markdown ç¬¦å·ï¼š
   - ç¦æ­¢ä½¿ç”¨ # ## ### æ ‡é¢˜ç¬¦å·
   - ç¦æ­¢ä½¿ç”¨ * - åˆ—è¡¨ç¬¦å·
   - ç¦æ­¢ä½¿ç”¨ [ ] å¤é€‰æ¡†
   - ç¦æ­¢ä½¿ç”¨ --- åˆ†éš”çº¿
   - ç¦æ­¢ä½¿ç”¨ ** __ åŠ ç²—æ–œä½“
   - ç¦æ­¢ä½¿ç”¨ > å¼•ç”¨ç¬¦å·

2. åªä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
   - emoji ä½œä¸ºè§†è§‰æ ‡è®°
   - æ•°å­—åºå·ï¼ˆ1. 2. 3.ï¼‰
   - ç©ºè¡Œåˆ†éš”æ®µè½
   - çº¯æ–‡æœ¬

3. è¯­æ°”è¦æ±‚ï¼š
   - å®¢è§‚ã€ä¸­æ€§ï¼Œä¸è¦è¯´æ•™
   - ä¸è¦ä½¿ç”¨"å¤ªæ£’äº†"ã€"åŠ æ²¹"ã€"ç»§ç»­åŠªåŠ›"ç­‰é¼“åŠ±æ€§è¯­è¨€
   - åªé™ˆè¿°äº‹å®å’Œä¿¡æ¯

**è¾“å‡ºæ¨¡æ¿ï¼ˆä¸¥æ ¼éµå®ˆï¼‰ï¼š**

ğŸ¯ æ ¸å¿ƒä¸»é¢˜
[ä¸€å¥è¯æ¦‚æ‹¬ï¼Œä¸è¶…è¿‡20å­—]

ğŸ“š å…³é”®ä¿¡æ¯ç‚¹
1. [ä¿¡æ¯ç‚¹ 1]
2. [ä¿¡æ¯ç‚¹ 2]
3. [ä¿¡æ¯ç‚¹ 3]

ğŸ”— å†…å®¹è„‰ç»œ
[ä¸€å¥è¯è¯´æ˜è¿™äº›å†…å®¹çš„å…³ç³»]

âœ… å·²è¦†ç›–çš„å†…å®¹
1. [å†…å®¹ 1]
2. [å†…å®¹ 2]

â“ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æŸ¥é˜…
1. [é—®é¢˜ 1]
2. [é—®é¢˜ 2]

ğŸ’¡ å›é¡¾å»ºè®®
1. [å»ºè®® 1]
2. [å»ºè®® 2]
3. [å»ºè®® 3]

ğŸ“Š å†…å®¹ç‰¹ç‚¹
[ä¸€å¥è¯è§‚å¯Ÿ]

**ç¤ºä¾‹ï¼ˆæ­£ç¡®æ ¼å¼ï¼‰ï¼š**

ğŸ¯ æ ¸å¿ƒä¸»é¢˜
React Hooks çš„åŸºç¡€ç”¨æ³•å’Œæ ¸å¿ƒæ¦‚å¿µ

ğŸ“š å…³é”®ä¿¡æ¯ç‚¹
1. useState ç”¨äºå‡½æ•°ç»„ä»¶ä¸­çš„çŠ¶æ€ç®¡ç†
2. useEffect å¤„ç†å‰¯ä½œç”¨å’Œç”Ÿå‘½å‘¨æœŸ
3. useContext ç®€åŒ– Context çš„ä½¿ç”¨

âœ… å·²è¦†ç›–çš„å†…å®¹
1. åŸºç¡€ Hooks çš„è¯­æ³•å’Œç”¨æ³•
2. è‡ªå®šä¹‰ Hook çš„åˆ›å»ºæ–¹å¼

â“ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æŸ¥é˜…
1. useEffect çš„æ¸…ç†å‡½æ•°æœºåˆ¶
2. æ€§èƒ½ä¼˜åŒ– Hook çš„ä½¿ç”¨åœºæ™¯

ğŸ’¡ å›é¡¾å»ºè®®
1. å®è·µ useState å’Œ useEffect çš„ç»„åˆä½¿ç”¨
2. å°è¯•åˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ Hook
3. æŸ¥é˜…å®˜æ–¹æ–‡æ¡£äº†è§£ä¾èµ–æ•°ç»„çš„ç»†èŠ‚

ğŸ“Š å†…å®¹ç‰¹ç‚¹
æ¦‚å¿µå­¦ä¹ å‹ï¼Œè¦†ç›–äº† React Hooks çš„ä¸»è¦åŠŸèƒ½
"""


def format_captures_for_analysis(captures):
    """
    å°†æ•æ‰è®°å½•æ ¼å¼åŒ–ä¸º Prompt è¾“å…¥
    """
    captures_text = []
    for idx, capture in enumerate(captures, 1):
        captures_text.append(f"""
ã€æ•æ‰ {idx}ã€‘
- ID: #{capture['id']}
- æ—¶é—´: {capture['timestamp']}
- å†…å®¹: {capture['selected_text'][:200]}{'...' if len(capture['selected_text']) > 200 else ''}
- é¡µé¢: {capture['page_title'] or 'N/A'}
- URL: {capture['page_url']}
""")
    return "\n".join(captures_text)

